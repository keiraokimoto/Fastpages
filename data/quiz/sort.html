<link rel="shortcut icon" type="image/x-icon" href="/Fastpages/images/favicon.ico" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>

<table id="flaskTable" class="table cell-border stripe" style="width:100%;">
    <thead id="flaskHead">
        <tr>
            <th>Subject</th>
            <th>ID</th>
            <th>Question</th>
            <th>Answer</th>
            <th>Pinned</th>
        </tr>
    </thead>
    <tbody id="flaskBody"></tbody>
</table>

<!-- Script is layed out in a sequence (without a function) and will execute when page is loaded -->
<script>
  $(document).ready(function() {
  
  dataX = {};
  fetch('http://localhost:5000/api/quiz/questions', { mode: 'cors' })
    .then(response => {
      if (!response.ok) {
        throw new Error('API response failed');
      }
      return response.json();
    })
    .then(data => {
      for (const row of data) {        
        dataX[row.id] = row;        
        $('#flaskBody').append('<tr><td>' + 
            row.subject + '</td><td>' + 
            row.qid + '</td><td>' + 
            row.question + '</td><td>' + 
            row.answer +  '</td>' +
            createPinnedColumn(row.id, row.pinned)
            + '</tr>'
        );        
      } 
      $("#flaskTable").DataTable();
      const pinb = document.getElementById('pinner');
      if (pinb != undefined) {
        pinb.addEventListener("click", handlePinEvent);
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
  });

  function createPinnedColumn(id, isPinned) {    
    label = '' ; // isPinned ? 'pinned' : 'unpinned';
    checked = (isPinned >= 1) ? 'checked' : '';
    b = '<td><input id="' + id + '" ' + isPinned +  
        '" type="checkbox" name="pinner" value="' + 
        label + '" ' + checked +
        ' onclick="handlePinEvent(event)">' + '<span style="margin-left:5px;">' + label + '</span>' + 
        '</td>';    
    return b;
  }
  function handlePinEvent(event) {  
    
    pinned = event.target.checked;
    rec = dataX[event.target.id];
    // TODO: uset setPinned api
    // event.target.value = pinned ? 'pinned' : 'unpinned';
      
  }

</script>

